

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Разработчикам приложений &mdash; User Manual: Blend4Web vv15.12</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="author" title="À propos de ces documents"
              href="about.html"/>
    <link rel="top" title="User Manual: Blend4Web vv15.12" href="index.html"/>
        <link rel="next" title="Разработчикам движка" href="developers_advanced.html"/>
        <link rel="prev" title="Визуальное программирование" href="logic_editor.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        

        
          <a href="index.html" class="icon icon-home"> Blend4Web. User Manual
        

        
        </a>

        
          
          
            <div class="version">
              v15.12
            </div>
          
        

        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

        
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="about.html">Общие сведения</a></li>
<li class="toctree-l1"><a class="reference internal" href="features.html">Функционал движка</a></li>
<li class="toctree-l1"><a class="reference internal" href="first_steps.html">Экспресс-установка</a></li>
<li class="toctree-l1"><a class="reference internal" href="setup.html">Развёртывание среды разработки</a></li>
<li class="toctree-l1"><a class="reference internal" href="workflow.html">Рабочий процесс</a></li>
<li class="toctree-l1"><a class="reference internal" href="viewer.html">Просмотрщик сцен</a></li>
<li class="toctree-l1"><a class="reference internal" href="web_player.html">Веб-плеер</a></li>
<li class="toctree-l1"><a class="reference internal" href="addon.html">Аддон</a></li>
<li class="toctree-l1"><a class="reference internal" href="objects.html">Объекты</a></li>
<li class="toctree-l1"><a class="reference internal" href="camera.html">Камера</a></li>
<li class="toctree-l1"><a class="reference internal" href="materials.html">Материалы</a></li>
<li class="toctree-l1"><a class="reference internal" href="textures.html">Текстуры</a></li>
<li class="toctree-l1"><a class="reference internal" href="node_materials.html">Нодовые материалы</a></li>
<li class="toctree-l1"><a class="reference internal" href="lighting.html">Освещение, тени и фон</a></li>
<li class="toctree-l1"><a class="reference internal" href="postprocessing_effects.html">Постпроцессинговые эффекты</a></li>
<li class="toctree-l1"><a class="reference internal" href="particles.html">Система частиц. Флюиды</a></li>
<li class="toctree-l1"><a class="reference internal" href="particles_instancing.html">Система частиц. Инстансинг</a></li>
<li class="toctree-l1"><a class="reference internal" href="animation.html">Анимация</a></li>
<li class="toctree-l1"><a class="reference internal" href="outdoor_rendering.html">Рендеринг наружных сцен</a></li>
<li class="toctree-l1"><a class="reference internal" href="gamma_alpha.html">Гамма-коррекция и альфа-композитинг</a></li>
<li class="toctree-l1"><a class="reference internal" href="audio.html">Звуковая подсистема</a></li>
<li class="toctree-l1"><a class="reference internal" href="physics.html">Физика</a></li>
<li class="toctree-l1"><a class="reference internal" href="nla.html">Нелинейная анимация</a></li>
<li class="toctree-l1"><a class="reference internal" href="logic_editor.html">Визуальное программирование</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Разработчикам приложений</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#project-management">Управление проектами</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#project-manager">Project Manager</a></li>
<li class="toctree-l3"><a class="reference internal" href="#create-new-project">Мастер создания проектов</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#advanced-project-management">Расширенное управление проектами</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id5">Зависимости</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id6">Список проектов</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id7">Структура проекта</a></li>
<li class="toctree-l3"><a class="reference internal" href="#b4w-project">Конфигурационный файл <code class="docutils literal"><span class="pre">.b4w_project</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#id8">Низкоуровневое создание проекта</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id9">Разработка нескольких приложений в составе проекта</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id10">Сборка проекта</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id11">Автоматический экспорт ресурсов</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id12">Конвертация ресурсов</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id13">Развертывание проекта</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id14">Удаление проекта</a></li>
<li class="toctree-l3"><a class="reference internal" href="#sdk">Обновление приложений на новые версии SDK</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id15">Пути к загружаемым ресурсам приложения</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id16">Написание логики приложений</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#hello-world">Приложение Hello world!</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id17">Загрузка сцены в приложение</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id18">Система модулей</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id19">Быстрое создание приложений</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#converter">Конвертация ресурсов</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id21">Зависимости</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id22">Формат данных</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#code-snippets">Примеры кода</a></li>
<li class="toctree-l2"><a class="reference internal" href="#event-model">Событийная модель</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#index-0">Сенсоры</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id26">Пример</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#repo-file-structure">Файловая структура SDK</a></li>
<li class="toctree-l2"><a class="reference internal" href="#browser-for-local-loading">Загрузка локальных ресурсов</a></li>
<li class="toctree-l2"><a class="reference internal" href="#quality-settings">Профили качества изображения</a></li>
<li class="toctree-l2"><a class="reference internal" href="#canvas-nonfullscreen-coords">Специфика неполноэкранных приложений</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="developers_advanced.html">Разработчикам движка</a></li>
<li class="toctree-l1"><a class="reference internal" href="git_short_manual.html">Работа в команде с использованием Git</a></li>
<li class="toctree-l1"><a class="reference internal" href="problems_and_solutions.html">Проблемы и решения</a></li>
<li class="toctree-l1"><a class="reference internal" href="release_notes.html">Замечания к релизам</a></li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">Blend4Web. User Manual</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>Разработчикам приложений</li>
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="developers">
<span id="id1"></span><h1>Разработчикам приложений<a class="headerlink" href="#developers" title="Lien permanent vers ce titre">¶</a></h1>
<div class="section" id="project-management">
<span id="app-building"></span><span id="id2"></span><h2>Управление проектами<a class="headerlink" href="#project-management" title="Lien permanent vers ce titre">¶</a></h2>
<p>Начиная с версии 15.09, SDK включает систему управления проектами, которая позволяет:</p>
<blockquote>
<div><ul class="simple">
<li>просматривать список и внутреннюю структуру имеющихся проектов;</li>
<li>запускать приложения, просматривать сцены в программе-просмотрщике, загружать исходные файлы сцен в Blender;</li>
<li>создавать и конфигурировать новые приложения, в том числе на основе готовых шаблонов;</li>
<li>осуществлять сборку приложения и его конверсию в форму, удобную для последующего размещения на сервере;</li>
<li>конвертировать ресурсы приложения (текстуры, звуковые и видео-файлы) в альтернативные форматы для обеспечения кроссбраузерности и кроссплатформенности;</li>
<li>автоматизировать повторный экспорт всех сцен из состава приложения, включая файлы в формате JSON и HTML.</li>
<li>удалять проекты.</li>
</ul>
</div></blockquote>
<p>Управлять проектами возможно двумя способами: с помощью консольной утилиты <em>project.py</em>, имеющей простой формат вызова и подробную справку, либо в графической форме с помощью веб-приложения, выполняющегося на локальном сервере разработчика. Сервер не требует каких-либо дополнительных настроек и запускается автоматически при старте Blender. Главная страница приложения Project Manager открывается с помощью кнопки <code class="docutils literal"><span class="pre">Project</span> <span class="pre">Manager</span></code> в Blender.</p>
<div class="section" id="project-manager">
<h3>Project Manager<a class="headerlink" href="#project-manager" title="Lien permanent vers ce titre">¶</a></h3>
<p>Данное графическое приложение позволяет осуществлять базовые функции управления проектами, такие как просмотр, компиляция, экспорт сцен и конвертация ресурсов.
Разработчикам, которым требуется полный набор функций для управления проектами, следует использовать скрипт <em>project.py</em> и ручное редактирование конфигурационных файлов <em>.b4w_project</em>.</p>
<p>Приложение <em>Project Manager</em> доступно из раздела <em>Tools</em> главной страницы SDK. При запуске приложение выводит список из всех проектов, находящихся в установленном SDK.</p>
<p>Команды для управления проектами находятся в верхней части страницы, для создания нового проекта необходимо нажать на ссылку <code class="docutils literal"><span class="pre">[Create</span> <span class="pre">New</span> <span class="pre">Project]</span></code>; для загрузки внешнего проекта - <code class="docutils literal"><span class="pre">[Import</span> <span class="pre">Project</span> <span class="pre">Archive]</span></code>; чтобы скрыть или показать проекты, изначально входящие в состав SDK - <code class="docutils literal"><span class="pre">[Hide/Show</span> <span class="pre">Stock</span> <span class="pre">Projects]</span></code>.</p>
<blockquote>
<div><a class="reference internal image-reference" href="_images/project_actions.png"><img alt="_images/project_actions.png" class="align-center" src="_images/project_actions.png" style="width: 100%;" /></a>
</div></blockquote>
<p>Команды управления конкретным проектом находятся справа от него</p>
<blockquote>
<div><img alt="_images/project_commands.png" class="align-center" src="_images/project_commands.png" />
</div></blockquote>
<ol class="arabic simple">
<li>Компиляция проекта (недоступно для типов проекта WebPlayer JSON и WebPlayer HTML).</li>
<li>Реэкспорт блендеровских сцен в проекте.</li>
<li>Конвертация медиа ресурсов.</li>
<li>Экспортирование и дальнейшая загрузка проекта.</li>
<li>Удаление проекта со всеми зависимостями.</li>
</ol>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Все пути берутся из конфигурационного файла .b4w_project.</p>
</div>
</div>
<div class="section" id="create-new-project">
<span id="id3"></span><h3>Мастер создания проектов<a class="headerlink" href="#create-new-project" title="Lien permanent vers ce titre">¶</a></h3>
<p>Мастер создания новых проектов входит в состав приложения Project Manager и вызывается по ссылке <code class="docutils literal"><span class="pre">[Create</span> <span class="pre">New</span> <span class="pre">Project]</span></code> на главной странице этого приложения.</p>
<blockquote>
<div><a class="reference internal image-reference" href="_images/create_project.png"><img alt="_images/create_project.png" class="align-center" src="_images/create_project.png" style="width: 100%;" /></a>
</div></blockquote>
<ol class="arabic">
<li><p class="first">Имя проекта. Текущим именем будут названы директории в &#8220;apps_dev/имя_проекта&#8221;, &#8220;deploy/assets/имя_проекта&#8221;, blender и &#8220;deploy/apps/имя_проекта&#8221;. Для лучшей совместимости рекомендуется использовать буквы и нижнее подчеркивание.</p>
</li>
<li><p class="first">Название проекта. Это имя будет показываться в заголовке веб-браузера.</p>
</li>
<li><p class="first">Имя автора проекта.</p>
</li>
<li><p class="first">Добавить шаблоны приложения. В директорию проекта &#8220;apps_dev/имя_проекта&#8221; будут добавлены стандартные шаблоны приложения: html-файл, css-файл, js-файл.</p>
</li>
<li><p class="first">Добавить шаблоны сцены. В директорию &#8220;deploy/assets/имя_проекта&#8221; будет добавлен стандартный json-файл; в директорию &#8220;blender/имя_проекта&#8221; - blend-файл.</p>
</li>
<li><p class="first">Скопировать скрипт менеджера проектов. Скрипт project.py будет скопирован в директорию проекта.</p>
</li>
<li><p class="first">Все файлы проекта будут находиться в одной директории. Предпочтительно использовать для маленьких проектов, таких как уроки и примеры. Для данной опции доступен только тип проекта - &#8220;update&#8221;.</p>
</li>
<li><p class="first">Тип собираемого проекта. Здесь возможны варианты:</p>
<blockquote>
<div><ul class="simple">
<li>&#8220;External&#8221; - движок берется из директории &#8220;deploy/apps/common/&#8221;. Компилируются только файлы приложения;</li>
<li>&#8220;Copy&#8221; - движок копируется в директорию собранного приложения. Компилируются только файлы приложения;</li>
<li>&#8220;Compile&#8221; - исходники движка компилируются вместе со скриптами приложения;</li>
<li>&#8220;Update&#8221; - заменется движок в директории проекта;</li>
<li>&#8220;Webplayer JSON&#8221; - json-файл, находящийся в проекте, запускается при помощи веб-плеера в составе SDK;</li>
<li>&#8220;Webplayer HTML&#8221; - проект состоит из html-файла, внутри которого находятся все необходимые ресурсы.</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Уровень оптимизации javascript.</p>
<blockquote>
<div><ul class="simple">
<li>&#8220;Simple&#8221; - в коде заменяются имена переменных;</li>
<li>&#8220;Advanced&#8221; - призводится оптимизация кода.</li>
<li>&#8220;Whitespace Only&#8221; - в коде удаляются только пробелы;</li>
</ul>
</div></blockquote>
</li>
</ol>
</div>
</div>
<div class="section" id="advanced-project-management">
<span id="id4"></span><h2>Расширенное управление проектами<a class="headerlink" href="#advanced-project-management" title="Lien permanent vers ce titre">¶</a></h2>
<p>Расширенное управление проектами используется опытными разработчикам, которым необходима как большая степень гибкости, так и возвожность втоматизировать все рабочие процессы, связанные с разработкой приложений.</p>
<p>Для расширенного управления проектами следует использовать скрипт <em>project.py</em> и ручное редактирование конфигурационных файлов <em>.b4w_project</em>.</p>
<div class="section" id="id5">
<h3>Зависимости<a class="headerlink" href="#id5" title="Lien permanent vers ce titre">¶</a></h3>
<p>Система управления проектами работает на всех операционных системах, однако для некоторых операций может потребоваться установка дополнительных зависимостей. Проверить, установлены ли необходимые зависимости, можно с помощью команды:</p>
<div class="highlight-bash"><div class="highlight"><pre>./project.py check_deps
</pre></div>
</div>
<p>Для пользователей ОС Windows:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">python project.py check_deps</span>
</pre></div>
</div>
</div>
<div class="section" id="id6">
<h3>Список проектов<a class="headerlink" href="#id6" title="Lien permanent vers ce titre">¶</a></h3>
<div class="highlight-bash"><div class="highlight"><pre>python3 project.py -p myproject list
</pre></div>
</div>
<p>Выводит список проектов, находящихся в SDK.</p>
</div>
<div class="section" id="id7">
<h3>Структура проекта<a class="headerlink" href="#id7" title="Lien permanent vers ce titre">¶</a></h3>
<p>Типовое приложение, разрабатываемая с помощью системы управления проектами имеет вид:</p>
<div class="highlight-python"><div class="highlight"><pre>blend4web/
    apps_dev/
        myproject/
            project.py
            .b4w_project
            myproject.js
            myproject.css
            myproject_dev.html
    blender/
        myproject/
            myproject.blend
    deploy/
        apps/
            my_project/
                myproject.js
                myproject.css
                myproject.html
        assets/
            myproject/
                myproject.json
                myproject.bin
</pre></div>
</div>
<p>Как видно, это приложение состоит из 4 различных директорий:</p>
<ol class="arabic simple">
<li>apps_dev/myproject. Содержит исходные файлы приложений проекта.</li>
<li>blender/myproject. Содержит исходные файлы сцен проекта.</li>
<li>deploy/assets/myproject. Содержит экспортированные файлы сцен проекта.</li>
<li>deploy/apps/myproject. Содержит экспортированные файлы сцен проекта.</li>
</ol>
<p>Кроме того, операция развёртывания (deploy) может создавать ещё одну директорию, однако она обычно располагается за пределами SDK и её название и расположение зависит от структуры директорий на конечном сервере.</p>
</div>
<div class="section" id="b4w-project">
<h3>Конфигурационный файл <code class="docutils literal"><span class="pre">.b4w_project</span></code><a class="headerlink" href="#b4w-project" title="Lien permanent vers ce titre">¶</a></h3>
<p>Если при запуске скрипта <em>project.py</em> не были заданы параметры проекта, то они берутся из конфигурационного файла.</p>
<div class="highlight-python"><div class="highlight"><pre>[info]
author =
name =
title =

[paths]
assets_dirs =
blend_dirs =
blender_exec =
build_dir =
deploy_dir =

[compile]
apps =
css_ignore =
engine_type = external
js_ignore =
optimization = simple
use_physics =
use_smaa_textures =
version =

[deploy]
assets_path_prefix =
remove_exist_ext_dir =
</pre></div>
</div>
</div>
<div class="section" id="id8">
<h3>Низкоуровневое создание проекта<a class="headerlink" href="#id8" title="Lien permanent vers ce titre">¶</a></h3>
<div class="highlight-bash"><div class="highlight"><pre>./project.py init myproject
</pre></div>
</div>
<p>Команда создает проект с указанной именем в текущей директории. По умолчанию в директории проекта будет находиться только конфигурационный файл.</p>
<p>Доступные опции:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">-A</span> <span class="pre">|</span> <span class="pre">--copy-app-templates</span></code> (необязательная) создает в директории проекта стандартные шаблоны
приложения (<em>&lt;имя проекта&gt;_dev.html</em>, <em>&lt;имя проекта&gt;.js</em>, <em>&lt;имя проекта&gt;.css</em>).</li>
<li><code class="docutils literal"><span class="pre">-B</span> <span class="pre">|</span> <span class="pre">--bundle</span></code> (необязательная) все файлы проекта будут размещены в одной директории.</li>
<li><code class="docutils literal"><span class="pre">-C</span> <span class="pre">|</span> <span class="pre">--author</span></code> (необязательная) записывает в конфигурационный файл имя автора или компании.</li>
<li><code class="docutils literal"><span class="pre">-o</span> <span class="pre">|</span> <span class="pre">--optimization</span></code> (необязательная) записывает в конфигурационный файл тип оптимизации скриптов.</li>
<li><code class="docutils literal"><span class="pre">-P</span> <span class="pre">|</span> <span class="pre">--copy-project-script</span></code> (необязательная) создает скрипт <em>project.py</em> в директории проекта.</li>
<li><code class="docutils literal"><span class="pre">-S</span> <span class="pre">|</span> <span class="pre">--copy-scene-templates</span></code> (необязательная) создает в директориях <code class="docutils literal"><span class="pre">deploy/assets/&lt;имя</span> <span class="pre">проекта&gt;</span></code>
и <code class="docutils literal"><span class="pre">blender/&lt;имя</span> <span class="pre">проекта&gt;</span></code> (необязательная) стандартные шаблоны сцены (<em>&lt;имя проекта&gt;.json/.bin</em> и <em>&lt;имя проекта&gt;.blend</em> соответственно).</li>
<li><code class="docutils literal"><span class="pre">-T</span> <span class="pre">|</span> <span class="pre">--title&quot;</span></code> (необязательная) записывает в конфигурационный файл заголовок проекта.
При сборке он будет добавлен в html-тэг <code class="docutils literal"><span class="pre">&lt;title&gt;</span></code>.</li>
<li><code class="docutils literal"><span class="pre">-t</span> <span class="pre">|</span> <span class="pre">--engine-type</span></code> (необязательная) записывает в конфигурационный файл тип собираемого приложения.</li>
</ul>
<p>Пример:</p>
<div class="highlight-bash"><div class="highlight"><pre>./project.py init -AS -C Blend4Web -o simple -T MyProject -t external myproject
</pre></div>
</div>
<p>Данная команда создаст директорию <em>myproject</em>, в которой будут находиться файлы:
<em>myproject.js</em>, <em>myproject.css</em>, <em>myproject_dev.html</em> и <em>.b4w_project</em>.</p>
<p>Файл .b4w_project будет выглядеть следущим образом:</p>
<div class="highlight-python"><div class="highlight"><pre>[info]
author = Blend4Web
name = myproject
title = MyProject

[paths]
assets_dirs = deploy/assets/myproject;
blend_dirs = blender/myproject;
blender_exec = blender
build_dir = deploy/apps/myproject
deploy_dir =

[compile]
apps =
css_ignore =
engine_type = external
js_ignore =
optimization = simple
use_physics =
use_smaa_textures =
version =

[deploy]
assets_path_prefix =
remove_exist_ext_dir =
</pre></div>
</div>
</div>
<div class="section" id="id9">
<h3>Разработка нескольких приложений в составе проекта<a class="headerlink" href="#id9" title="Lien permanent vers ce titre">¶</a></h3>
<p>В проекте может содержаться несколько приложений. Для этого необходимо в конфигурационном файле указать соответствующие HTML-файлы через точку с запятой:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="o">...</span>
<span class="p">[</span><span class="nb">compile</span><span class="p">]</span>
<span class="n">apps</span> <span class="o">=</span> <span class="n">myapp1</span><span class="p">;</span><span class="n">myapp2</span><span class="p">;</span>
<span class="o">...</span>
</pre></div>
</div>
</div>
<div class="section" id="id10">
<h3>Сборка проекта<a class="headerlink" href="#id10" title="Lien permanent vers ce titre">¶</a></h3>
<div class="highlight-bash"><div class="highlight"><pre>python3 project.py -p myproject compile
</pre></div>
</div>
<p>Собирает проект в директории <code class="docutils literal"><span class="pre">deploy/apps/myproject</span></code>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Для работы скрипта необходимо установить java и <a class="reference external" href="https://www.java.com/ru/download/help/path.xml">записать ее в переменную среды PATH</a></p>
</div>
<p>Доступные опции:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">&quot;-a</span> <span class="pre">|</span> <span class="pre">--app&quot;</span></code> (необязательная) указывает на HTML-файл, относительно которого будет собираться приложение для проекта.</li>
<li><code class="docutils literal"><span class="pre">&quot;-c</span> <span class="pre">|</span> <span class="pre">--css-ignore&quot;</span></code> (необязательная) добавляет в исключения стили, которые не будут скомпилированы.</li>
<li><code class="docutils literal"><span class="pre">&quot;-j</span> <span class="pre">|</span> <span class="pre">--js-ignore&quot;</span></code> (необязательная) добавляет в исключения скрипты, которые не будут скомпилированы.</li>
<li><code class="docutils literal"><span class="pre">&quot;-o</span> <span class="pre">|</span> <span class="pre">--optimization&quot;</span></code> (необязательная) используется для указания метода оптимизации js-файлов.
Доступные варианты: <code class="docutils literal"><span class="pre">whitespace</span></code>, <code class="docutils literal"><span class="pre">simple</span></code> (по умолчанию) и <code class="docutils literal"><span class="pre">advanced</span></code>.</li>
<li><code class="docutils literal"><span class="pre">&quot;-t</span> <span class="pre">|</span> <span class="pre">--engine-type&quot;</span></code> (необязательная) определяет тип компилируемого приложения. Доступны четыре варианта:
<em>external</em> (по умолчанию), <em>copy</em>, <em>compile</em>, <em>update</em>.</li>
<li><code class="docutils literal"><span class="pre">&quot;-v</span> <span class="pre">|</span> <span class="pre">--version&quot;</span></code> добавляет версию к адресам скриптов и стилей.</li>
</ul>
<p>Требования, накладываемые компилятором:</p>
<ul class="simple">
<li>В корне директории должен находится единственный html-файл, если не указана опция <code class="docutils literal"><span class="pre">-a</span></code>.</li>
<li>Скрипты и стили могут находиться как в корне проекта (приложения), так и
во вложенных папках.</li>
</ul>
</div>
<div class="section" id="id11">
<h3>Автоматический экспорт ресурсов<a class="headerlink" href="#id11" title="Lien permanent vers ce titre">¶</a></h3>
<div class="highlight-bash"><div class="highlight"><pre>python3 project.py -p myproject reexport
</pre></div>
</div>
<p>Повторно экспортирует blend-файлы в форматах JSON и HTML.</p>
<p>Доступные опции:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">&quot;-b</span> <span class="pre">|</span> <span class="pre">--blender_exec&quot;</span></code> путь к исполняемому файлу blender.</li>
<li><code class="docutils literal"><span class="pre">&quot;-s</span> <span class="pre">|</span> <span class="pre">--assets&quot;</span></code> определяет директорию с ресурсами сцены.</li>
</ul>
</div>
<div class="section" id="id12">
<h3>Конвертация ресурсов<a class="headerlink" href="#id12" title="Lien permanent vers ce titre">¶</a></h3>
<div class="highlight-bash"><div class="highlight"><pre>python3 project.py -p myproject convert_resources
</pre></div>
</div>
<p>Конвертирует внешние ресурсы (текстуры, звуковые и видео-файлы) проекта
в альтернативные форматы для обеспечения кроссбраузерности и кроссплатформенности.</p>
<p>Доступные опции:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">&quot;-s</span> <span class="pre">|</span> <span class="pre">--assets&quot;</span></code> определяет директорию с ресурсами сцены.</li>
</ul>
<p>Более подробно о процессе конвертации ресурсов сказано в <a class="reference internal" href="#converter"><span>соответствующем разделе</span></a>.</p>
</div>
<div class="section" id="id13">
<h3>Развертывание проекта<a class="headerlink" href="#id13" title="Lien permanent vers ce titre">¶</a></h3>
<div class="highlight-bash"><div class="highlight"><pre>python3 project.py -p myproject deploy
</pre></div>
</div>
<p>Сохраняет проект во внешнюю директорию со всеми необходимыми зависимостями.</p>
<p>Доступные опции:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">&quot;-d</span> <span class="pre">|</span> <span class="pre">--dir&quot;</span></code> директория для развертывания проекта.</li>
<li><code class="docutils literal"><span class="pre">&quot;-e</span> <span class="pre">|</span> <span class="pre">--assets-path&quot;</span></code> путь к файлам ресурсов.</li>
<li><code class="docutils literal"><span class="pre">&quot;-o</span> <span class="pre">|</span> <span class="pre">--override&quot;</span></code> (необязательная) удаляет директорию, если она существует.</li>
<li><code class="docutils literal"><span class="pre">&quot;-s</span> <span class="pre">|</span> <span class="pre">--assets&quot;</span></code> определяет директорию с ресурсами сцены.</li>
<li><code class="docutils literal"><span class="pre">&quot;-t</span> <span class="pre">|</span> <span class="pre">--engine-type&quot;</span></code> (необязательная) определяет тип развертываемого приложения.</li>
</ul>
</div>
<div class="section" id="id14">
<h3>Удаление проекта<a class="headerlink" href="#id14" title="Lien permanent vers ce titre">¶</a></h3>
<div class="highlight-bash"><div class="highlight"><pre>python3 project.py -p myproject remove
</pre></div>
</div>
<p>Удаляет проект. Удаляемые директории берутся из конфигурационного файла.</p>
</div>
<div class="section" id="sdk">
<h3>Обновление приложений на новые версии SDK<a class="headerlink" href="#sdk" title="Lien permanent vers ce titre">¶</a></h3>
<p>В процессе обновления на новые версии движка чаще всего возникает две проблемы:</p>
<ol class="arabic simple">
<li>Несоответствие модулей новой и старой версии движка.</li>
<li>Несоответствие старых и новых API движка.</li>
</ol>
<p>Для того, чтобы обновить список модулей, подключаемых в необфусцированной версии приложений, необходимо перейти в директорию с исходными файлами приложений <code class="docutils literal"><span class="pre">apps_dev/my_project</span></code>. Затем необходимо вызвать скрипт, генерирующий пути к файлам движка:</p>
<div class="highlight-bash"><div class="highlight"><pre>python3 ../../scripts/mod_list.py
</pre></div>
</div>
<p>Для пользователей ОС Windows:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">python ..\..\scripts\mod_list.py</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Стоит отдельно отметить, что для запуска скриптов требуется интерпретатор языка Python версии 3.x</p>
</div>
<p>В консоли появится список модулей, которые необходимо скопировать и вставить в главный HTML-файл:</p>
<div class="highlight-html"><div class="highlight"><pre><span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">&quot;UTF-8&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">&quot;viewport&quot;</span> <span class="na">content=</span><span class="s">&quot;width=device-width, initial-scale=1, maximum-scale=1&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;script </span><span class="na">type=</span><span class="s">&quot;text/javascript&quot;</span> <span class="na">src=</span><span class="s">&quot;../../src/b4w.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
    <span class="nt">&lt;script </span><span class="na">type=</span><span class="s">&quot;text/javascript&quot;</span> <span class="na">src=</span><span class="s">&quot;../../src/anchors.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
    <span class="nt">&lt;script </span><span class="na">type=</span><span class="s">&quot;text/javascript&quot;</span> <span class="na">src=</span><span class="s">&quot;../../src/animation.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
    <span class="nt">&lt;script </span><span class="na">type=</span><span class="s">&quot;text/javascript&quot;</span> <span class="na">src=</span><span class="s">&quot;../../src/assets.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
    <span class="nt">&lt;script </span><span class="na">type=</span><span class="s">&quot;text/javascript&quot;</span> <span class="na">src=</span><span class="s">&quot;../../src/batch.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
    <span class="nt">&lt;script </span><span class="na">type=</span><span class="s">&quot;text/javascript&quot;</span> <span class="na">src=</span><span class="s">&quot;../../src/boundings.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
    <span class="nt">&lt;script </span><span class="na">type=</span><span class="s">&quot;text/javascript&quot;</span> <span class="na">src=</span><span class="s">&quot;../../src/camera.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
    . . .
<span class="nt">&lt;/head&gt;</span>
</pre></div>
</div>
<p>Несоответствие API решается рефакторингом кода приложения. Все изменения подробно описываются в <a class="reference internal" href="release_notes.html#release-notes"><span>замечаниях к релизам</span></a>.</p>
</div>
<div class="section" id="id15">
<h3>Пути к загружаемым ресурсам приложения<a class="headerlink" href="#id15" title="Lien permanent vers ce titre">¶</a></h3>
<p>При загрузке .json-файлов необходимо использовать функцию <code class="docutils literal"><span class="pre">get_std_assets_path()</span></code> из модуля <em>config.js</em>:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">m_data</span><span class="p">.</span><span class="nx">load</span><span class="p">(</span><span class="nx">m_config</span><span class="p">.</span><span class="nx">get_std_assets_path</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;example/example.json&quot;</span><span class="p">,</span> <span class="nx">load_cb</span><span class="p">);</span>
</pre></div>
</div>
<p>После сборки готового приложения путь к данным изменится, а использование функции <code class="docutils literal"><span class="pre">get_std_assets_path()</span></code> позволит избежать возникновения проблемы с неверным путем.</p>
</div>
</div>
<div class="section" id="id16">
<h2>Написание логики приложений<a class="headerlink" href="#id16" title="Lien permanent vers ce titre">¶</a></h2>
<div class="section" id="hello-world">
<h3>Приложение Hello world!<a class="headerlink" href="#hello-world" title="Lien permanent vers ce titre">¶</a></h3>
<p>Простейшее приложение на основе Blend4Web может иметь вид:</p>
<div class="highlight-html"><div class="highlight"><pre><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
<span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;b4w.min.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;script&gt;</span>
<span class="kd">function</span> <span class="nx">hello</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">m_version</span> <span class="o">=</span> <span class="nx">b4w</span><span class="p">.</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;version&quot;</span><span class="p">);</span>
    <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="s2">&quot;Hello, Blend4Web &quot;</span> <span class="o">+</span> <span class="nx">m_version</span><span class="p">.</span><span class="nx">version</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;!&quot;</span><span class="p">;</span>
<span class="p">}</span>
<span class="nt">&lt;/script&gt;</span>
<span class="nt">&lt;/head&gt;</span>

<span class="nt">&lt;body</span> <span class="na">onload=</span><span class="s">&quot;hello()&quot;</span><span class="nt">&gt;&lt;/body&gt;</span>

<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div>
<p>Приложение выводит сообщение и текущую версию движка в окне браузера. Рассмотрим представленный пример. Базовый код движка подключается с помощью тега <code class="docutils literal"><span class="pre">&lt;script</span> <span class="pre">src=&quot;...&quot;&gt;</span></code>. Далее, приложение ожидает окончания загрузки страницы и выводит сообщение в окне браузера. В данном примере используется единственный модуль <code class="docutils literal"><span class="pre">version</span></code>, в котором находится одноимённая функция <code class="docutils literal"><span class="pre">version()</span></code>. Подробную информацию о предназначении модулей и функций движка можно найти в <a class="reference external" href="https://www.blend4web.com/api_doc/index.html">документации по API</a>.</p>
<p>Файл <code class="docutils literal"><span class="pre">b4w.min.js</span></code> со скомпилированным кодом движка необходимо скопировать из директории SDK <code class="docutils literal"><span class="pre">deploy/apps/common</span></code>  и разместить в той же директории, что и представленный HTML-файл.</p>
</div>
<div class="section" id="id17">
<h3>Загрузка сцены в приложение<a class="headerlink" href="#id17" title="Lien permanent vers ce titre">¶</a></h3>
<p>Для того, чтобы загрузить трёхмерную сцену, требуется выполнить следующую
последовательность действий:</p>
<ol class="arabic simple">
<li>Разместить на странице элемент <code class="docutils literal"><span class="pre">&lt;canvas&gt;</span></code>, на котором будет производиться
рендеринг.</li>
<li>После загрузки страницы, для инициализации контекста WebGL, вызвать функцию
<code class="docutils literal"><span class="pre">m_main.init()</span></code> с идентификатором созданного элемента.</li>
<li>Вызвать функцию <code class="docutils literal"><span class="pre">m_data.load()</span></code> для загрузки трёхмерной сцены.</li>
</ol>
<div class="highlight-html"><div class="highlight"><pre><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
<span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;b4w.min.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;script&gt;</span>
<span class="kd">function</span> <span class="nx">hello</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">m_main</span> <span class="o">=</span> <span class="nx">b4w</span><span class="p">.</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;main&quot;</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">m_data</span> <span class="o">=</span> <span class="nx">b4w</span><span class="p">.</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">);</span>

    <span class="kd">var</span> <span class="nx">canvas_elem</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;canvas_id&quot;</span><span class="p">);</span>
    <span class="nx">m_main</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="nx">canvas_elem</span><span class="p">);</span>
    <span class="nx">m_data</span><span class="p">.</span><span class="nx">load</span><span class="p">(</span><span class="s2">&quot;some_scene.json&quot;</span><span class="p">);</span>
<span class="p">}</span>
<span class="nt">&lt;/script&gt;</span>
<span class="nt">&lt;/head&gt;</span>

<span class="nt">&lt;body</span> <span class="na">onload=</span><span class="s">&quot;hello()&quot;</span><span class="nt">&gt;&lt;canvas</span> <span class="na">id=</span><span class="s">&quot;canvas_id&quot;</span><span class="nt">&gt;&lt;/canvas&gt;&lt;/body&gt;</span>

<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Следует отметить, что реальное приложение должно включать в себя проверку ошибок, настройку движка перед инициализацией, а также базовую систему взаимодействия с пользователем.</p>
</div>
</div>
<div class="section" id="id18">
<h3>Система модулей<a class="headerlink" href="#id18" title="Lien permanent vers ce titre">¶</a></h3>
<p>Несмотря на то, что движок предоставляет прикладному программисту API в объёме
десятков модулей, в процессе работы он занимает в глобальном пространстве имён
единственный объект <code class="docutils literal"><span class="pre">b4w</span></code>. При необходимости обращения к модулю, последний
импортируется с помощью вызова функции <code class="docutils literal"><span class="pre">b4w.require()</span></code>.</p>
<p>Допустима регистрация сторонних модулей, если их имена не пересекаются с
имеющимися. Регистрация происходит посредством вызова <code class="docutils literal"><span class="pre">b4w.register()</span></code>.
Проверка наличия модуля с некоторым именем может быть осуществлена с помощью
<code class="docutils literal"><span class="pre">b4w.module_check()</span></code>.</p>
<p>Пример:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="c1">// check if module exists</span>
<span class="k">if</span> <span class="p">(</span><span class="nx">b4w</span><span class="p">.</span><span class="nx">module_check</span><span class="p">(</span><span class="s2">&quot;my_module&quot;</span><span class="p">))</span>
    <span class="k">throw</span> <span class="s2">&quot;Failed to register module: my_module&quot;</span><span class="p">;</span>

<span class="c1">// register my_module</span>
<span class="nx">b4w</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="s2">&quot;my_module&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">exports</span><span class="p">,</span> <span class="nx">require</span><span class="p">)</span> <span class="p">{</span>

    <span class="c1">// import module &quot;version&quot;</span>
    <span class="kd">var</span> <span class="nx">m_version</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;version&quot;</span><span class="p">);</span>

    <span class="c1">// export print_build_date() from module &quot;my_module&quot;</span>
    <span class="nx">exports</span><span class="p">.</span><span class="nx">print_build_date</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// exec function date() from module &quot;version&quot;</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Engine build date: &quot;</span> <span class="o">+</span> <span class="nx">m_version</span><span class="p">.</span><span class="nx">date</span><span class="p">());</span>
    <span class="p">}</span>
<span class="p">});</span>

<span class="c1">// import module &quot;my_module&quot;</span>
<span class="kd">var</span> <span class="nx">m_my_module</span> <span class="o">=</span> <span class="nx">b4w</span><span class="p">.</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;my_module&quot;</span><span class="p">);</span>

<span class="c1">// exec function print_build_date() from module &quot;my_module&quot;</span>
<span class="nx">m_my_module</span><span class="p">.</span><span class="nx">print_build_date</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="section" id="id19">
<h3>Быстрое создание приложений<a class="headerlink" href="#id19" title="Lien permanent vers ce titre">¶</a></h3>
<p>Поскольку создание приложения с нуля может быть достаточно сложной операцей, особенно для начинающих пользователей, в движке существует специальное дополнение <code class="docutils literal"><span class="pre">app</span></code>:</p>
<div class="highlight-html"><div class="highlight"><pre><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
<span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;b4w.min.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;script&gt;</span>

<span class="kd">var</span> <span class="nx">m_app</span> <span class="o">=</span> <span class="nx">b4w</span><span class="p">.</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;app&quot;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">m_data</span> <span class="o">=</span> <span class="nx">b4w</span><span class="p">.</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">);</span>

<span class="nx">m_app</span><span class="p">.</span><span class="nx">init</span><span class="p">({</span>
    <span class="nx">canvas_container_id</span><span class="o">:</span> <span class="s2">&quot;container_id&quot;</span><span class="p">,</span>
    <span class="nx">callback</span><span class="o">:</span> <span class="nx">load_cb</span>
<span class="p">})</span>

<span class="kd">function</span> <span class="nx">load_cb</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">m_data</span><span class="p">.</span><span class="nx">load</span><span class="p">(</span><span class="s2">&quot;some_scene.json&quot;</span><span class="p">,</span> <span class="nx">loaded_cb</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">loaded_cb</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">m_app</span><span class="p">.</span><span class="nx">enable_controls</span><span class="p">();</span>
    <span class="nx">m_app</span><span class="p">.</span><span class="nx">enable_camera_controls</span><span class="p">();</span>
<span class="p">}</span>

<span class="nt">&lt;/script&gt;</span>
<span class="nt">&lt;/head&gt;</span>

<span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;container_id&quot;</span> <span class="na">style=</span><span class="s">&quot;width: 350px; height: 200px;&quot;</span><span class="nt">&gt;&lt;/div&gt;</span>
<span class="nt">&lt;/body&gt;</span>

<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div>
<p>В данном случае модуль <code class="docutils literal"><span class="pre">app</span></code> создаст элемент <code class="docutils literal"><span class="pre">&lt;canvas&gt;</span></code> внутри контейнера с
указанным идентификатором <code class="docutils literal"><span class="pre">container_id</span></code>, осуществит инициализацию движка при
загрузке страницы и сообщит о её окончании с помощью обработчика <code class="docutils literal"><span class="pre">load_cb()</span></code>.</p>
<p>Далее загружается сцена some_scene.json, аналогично предыдущему примеру, с тем лишь отличием, что по окончании загрузки этой сцены инициализируется подсистема управления и активируются средства для перемещения камеры с помощью клавиатуры и мыши (сенсорного экрана для мобильных устройств).</p>
<p>При использовании модуля <code class="docutils literal"><span class="pre">app</span></code> необходимо явно задавать размеры контейнерного элемента, поскольку в противном случае создаваемый элемент <code class="docutils literal"><span class="pre">&lt;canvas&gt;</span></code> будет иметь нулевые размеры.</p>
</div>
</div>
<div class="section" id="converter">
<span id="id20"></span><h2>Конвертация ресурсов<a class="headerlink" href="#converter" title="Lien permanent vers ce titre">¶</a></h2>
<p>Существующие браузеры не полностью поддерживают основные форматы медиаданных,
поэтому для создания кроссбраузерных приложений, а также с целью оптимизации,
необходимо использовать конвертер ресурсов.</p>
<p>В состав дистрибутива включен Python скрипт (scripts/converter.py) для
конвертации исходных файлов в другие форматы с целью расширения спектра
поддерживаемых платформ, а также для уменьшения размера ресурсов.</p>
<p>Данный скрипт может вызываться автоматически, используя систему управления проектами, либо вручную:</p>
<div class="highlight-bash"><div class="highlight"><pre>&gt; python3 &lt;path_to_sdk&gt;/scripts/converter.py <span class="o">[</span>-d file_path<span class="o">]</span> resize_textures <span class="p">|</span> convert_dds <span class="p">|</span> convert_media
</pre></div>
</div>
<p>Для пользователей ОС Windows:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">cd &lt;path_to_sdk&gt;\scripts</span>
<span class="go">python converter.py [-d file_path] resize_textures | convert_dds | convert_media</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Стоит отдельно отметить, что для запуска скриптов требуется интерпретатор языка Python версии 3.x</p>
</div>
<p>С помощью опции -d можно указать путь к директории,
в которой будет производится конвертация.</p>
<p>При необходимости исключить некоторую директорию при конвертации, достаточно
разместить в ней файл с именем <code class="docutils literal"><span class="pre">.b4w_no_conv</span></code>. На конвертацию во вложенных
директориях это не повлияет.</p>
<p>Аргумент <strong>resize_textures</strong> используется для изменения размера
текстур в режиме <strong>LOW</strong>.</p>
<div class="section" id="id21">
<h3>Зависимости<a class="headerlink" href="#id21" title="Lien permanent vers ce titre">¶</a></h3>
<p>Убедитесь, что у вас установлены все необходимые для конвертации программы. Это
можно сделать следующей командой:</p>
<div class="highlight-bash"><div class="highlight"><pre>&gt; python3 &lt;path_to_sdk&gt;/scripts/converter.py check_dependencies
</pre></div>
</div>
<p>Если какая-либо программа отсутствует, то будет выведено сообщения вида:</p>
<p><em>Couldn&#8217;t find PROGRAM_NAME.</em></p>
<p><strong>Linux</strong></p>
<p>Список необходимых программ можно посмотреть в таблице:</p>
<table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Название</th>
<th class="head">Пакет в дистрибутиве Ubuntu
15.04</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>ImageMagick</td>
<td>imagemagick</td>
</tr>
<tr class="row-odd"><td>NVIDIA Texture Tools</td>
<td>libnvtt-bin</td>
</tr>
<tr class="row-even"><td>Libav</td>
<td>libav-tools</td>
</tr>
<tr class="row-odd"><td>FFmpeg</td>
<td>ffmpeg</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Пользователи Linux могут дополнительно установить пакет qt-faststart, служащий для оптимизации загрузки медиаданных.</p>
</div>
<p><strong>Windows</strong></p>
<p>Для пользователей ОС Windows нет необходимости устанавливать эти пакеты, так как они уже находятся в составе SDK.</p>
<p><strong>Mac OS</strong></p>
<p>Пользователи Mac OS могут установить менеджер пакетов <a class="reference external" href="http://www.brew.sh/">brew</a>, а затем с его помощью установить некоторые недостающие пакеты.</p>
<p>Перед началом установки пакетов произведите установку библиотек libpng и libjpeg, выполнив следующие команды в консоле:</p>
<div class="highlight-bash"><div class="highlight"><pre>&gt; brew install libpng
&gt; brew install libjpeg
</pre></div>
</div>
<p>Теперь можно приступать к установке необходимых зависимостей:</p>
<div class="highlight-bash"><div class="highlight"><pre>&gt; brew install imagemagick
&gt; brew install --with-theora --with-libvpx --with-fdk-aac ffmpeg
</pre></div>
</div>
<p>Для установки NVIDIA Texture Tools необходимо склонировать репозиторий, выполнив следующую команду:</p>
<div class="highlight-bash"><div class="highlight"><pre>&gt; git clone https://github.com/TriumphLLC/NvidiaTextureTools.git
</pre></div>
</div>
<p>Теперь можно произвести сборку и установку пакета:</p>
<div class="highlight-bash"><div class="highlight"><pre>&gt; <span class="nb">cd </span>NvidiaTextureTools
&gt; ./configure
&gt; make
&gt; make install
</pre></div>
</div>
</div>
<div class="section" id="id22">
<h3>Формат данных<a class="headerlink" href="#id22" title="Lien permanent vers ce titre">¶</a></h3>
<p>Преобразование происходит по схеме:</p>
<dl class="docutils">
<dt>для аудио (convert_media):</dt>
<dd><ul class="first last simple">
<li>ogg -&gt; mp4</li>
<li>mp3 -&gt; ogg</li>
<li>mp4 -&gt; ogg</li>
</ul>
</dd>
</dl>
<p>Рекомендуется использовать в качестве базового формата <code class="docutils literal"><span class="pre">ogg</span></code>, в этом случае для обеспечения кросс-браузерной совместимости потребуется только преобразование из <code class="docutils literal"><span class="pre">ogg</span></code> в <code class="docutils literal"><span class="pre">mp4</span></code>. Пример файла на входе: <code class="docutils literal"><span class="pre">file_name.ogg</span></code>, пример файла на выходе: <code class="docutils literal"><span class="pre">file_name.altconv.mp4</span></code>.</p>
<dl class="docutils">
<dt>для видео (convert_media):</dt>
<dd><ul class="first last simple">
<li>webm -&gt; m4v</li>
<li>m4v -&gt; webm</li>
<li>ogv -&gt; webm</li>
<li>webm -&gt; seq</li>
<li>m4v -&gt; seq</li>
<li>ogv -&gt; seq</li>
</ul>
</dd>
</dl>
<p>Рекомендуется использовать в качестве базового формата <code class="docutils literal"><span class="pre">WebM</span></code>, в этом случае для обеспечения кросс-браузерной совместимости потребуется только преобразование из <code class="docutils literal"><span class="pre">webm</span></code> в <code class="docutils literal"><span class="pre">m4v</span></code> (из <code class="docutils literal"><span class="pre">webm</span></code> в <code class="docutils literal"><span class="pre">seq</span></code> для iPhone). Пример файла на входе: <code class="docutils literal"><span class="pre">file_name.webm</span></code>, пример файла на выходе: <code class="docutils literal"><span class="pre">file_name.altconv.m4v</span></code>.</p>
<dl class="docutils">
<dt>для изображений (convert_dds):</dt>
<dd><ul class="first last simple">
<li>png -&gt; dds</li>
<li>jpg -&gt; dds</li>
</ul>
</dd>
</dl>
<p>Пример файла на входе: <code class="docutils literal"><span class="pre">file_name.jpg</span></code>, пример файла на выходе: <code class="docutils literal"><span class="pre">file_name.jpg.dds</span></code>.</p>
<p>В целях оптимизации работы приложения существует возможность использования <code class="docutils literal"><span class="pre">min50</span></code> (уменьшенных вдвое) и <code class="docutils literal"><span class="pre">DDS</span></code> текстур.
Для этого при инициализации приложения необходимо передать следующие параметры:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">exports</span><span class="p">.</span><span class="nx">init</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">m_app</span><span class="p">.</span><span class="nx">init</span><span class="p">({</span>
        <span class="c1">// . . .</span>
        <span class="nx">assets_dds_available</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="nx">assets_min50_available</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="c1">// . . .</span>
    <span class="p">});</span>
    <span class="c1">// . . .</span>
<span class="p">}</span>
</pre></div>
</div>
<p id="seq">Файл формата <code class="docutils literal"><span class="pre">.seq</span></code> представляет собой раскадрированное видео. Применяется на
IE 11 и iPhone, поскольку на них возникают трудности при использовании видео
стандартного формата в качестве текстуры. Использование dds-формата для
изображений является более оптимальным по сравнению с другими форматами.</p>
<p>Движком могут использоваться файлы, созданные пользователем вручную и имеющие
следующие наименования: <code class="docutils literal"><span class="pre">file_name.altconv.m4v</span></code>, <code class="docutils literal"><span class="pre">file_name.altconv.mp3</span></code>
и т.д. Такие файлы необходимо размещать в одной директории с медиафайлом,
используемым в Blender&#8217;e.</p>
<p>Вы также можете использовать бесплатную кроссплатформенную программу
<a class="reference external" href="http://www.mirovideoconverter.com/">Miro Video Converter</a> для конвертации медиаданных.</p>
</div>
</div>
<div class="section" id="code-snippets">
<span id="id23"></span><h2>Примеры кода<a class="headerlink" href="#code-snippets" title="Lien permanent vers ce titre">¶</a></h2>
<p>В составе SDK присутствует приложение Code Snippets, демонстрирующее примеры использования функционала движка.</p>
<p>На данный момент приложение включает в себя следующие примеры:</p>
<blockquote>
<div><ul class="simple">
<li>Bone API - пример управления положением отдельных костей скелета</li>
<li>Camera Animation - создание процедурной анимации камеры</li>
<li>Camera Move Styles - переключение режимов управления камерой</li>
<li>Canvas Texture - пример работы с canvas-текстурой</li>
<li>Custom Anchors - процедурное создание аннотаций</li>
<li>Dynamic Geometry - процедурное изменение геометрии</li>
<li>Gyro (Mobile Only) - пример работы с гироскопом мобильных устройств</li>
<li>Instancing - копирование объектов сцены</li>
<li>Material API - изменение свойств материалов и замена материалов объекта</li>
<li>Morphing - использование ключей деформации объекта</li>
<li>Ray Test - использование функционала испускания лучей для определения препятствий</li>
</ul>
</div></blockquote>
<p>Приложение Code Snippets доступно по пути <code class="docutils literal"><span class="pre">SDK/apps_dev/code_snippets/code_snippets_dev.html</span></code>. Также оно доступно по ссылке из файла <code class="docutils literal"><span class="pre">index.html</span></code> в корне SDK.</p>
</div>
<div class="section" id="event-model">
<span id="id24"></span><h2>Событийная модель<a class="headerlink" href="#event-model" title="Lien permanent vers ce titre">¶</a></h2>
<p>Событийная модель предоставляет унифицированный интерфейс для описания
изменения состояний 3D сцены, упрощая обработку событий физики и действий
пользователя.</p>
<div class="section" id="index-0">
<span id="id25"></span><h3>Сенсоры<a class="headerlink" href="#index-0" title="Lien permanent vers ce titre">¶</a></h3>
<p>Основным блоком событийной модели является сенсор (sensor). Сенсор является программной сущностью, которая выдаёт на выходе единственное числовое значение, в большинстве случаев это либо 1 (единица), либо 0 (ноль). Некоторые сенсоры также несут полезную нагрузку (payload), которую можно получить в фунции-обработчике множества с помощью соответствующего API. Например, сенсор трассировки лучей (Ray Sensor) предоставляет относительную длину луча пересечения.</p>
<p id="index-1">Опрос значений сенсоров не доступен пользователю в виде API. Вместо этого, каждый сенсор должен присутствовать в одном или нескольких множествах (sensor manifold). Множество является логическим контейнером, ассоциированным с объектом на сцене. Оно генерирует ответ на определенный набор событий сенсоров в виде вызова функции-обработчика. Для определения множества необходимо иметь
следующую информацию (см. также описание функции <a class="reference external" href="https://www.blend4web.com/api_doc/module-controls.html#.create_sensor_manifold">create_sensor_manifold</a> в документации по API):</p>
<ul class="simple">
<li>Объект-носитель множества (например, бросаемый объект).</li>
<li>Уникальный идентификатор множества (например, &#8220;IMPACT&#8221;).</li>
<li>Тип вызова функции-обработчика (варианты: <code class="docutils literal"><span class="pre">CT_POSITIVE</span></code> - положительный результат логической функции, <code class="docutils literal"><span class="pre">CT_CONTINUOUS</span></code> - каждый кадр при положительном результате логической функции и один раз при нулевом, <code class="docutils literal"><span class="pre">CT_LEVEL</span></code> - любое изменение значения результата логической функции, <code class="docutils literal"><span class="pre">CT_SHOT</span></code> - одномоментный скачок результата логической функции, <code class="docutils literal"><span class="pre">CT_TRIGGER</span></code> - переключение результата логической функции, <code class="docutils literal"><span class="pre">CT_CHANGE</span></code> - любое изменение любого из сенсоров).</li>
<li>Массив сенсоров.</li>
<li>Логическая функция, определяющая при какой комбинации состояний сенсоров вызывается функция-обработчик.</li>
<li>Функция-обработчик.</li>
<li>Необязательный параметр, который может быть передан в функцию-обработчик.</li>
</ul>
<p>Более подробно об API, используемых в событийной модели движка, описано в документации модуля <a class="reference external" href="https://www.blend4web.com/api_doc/module-controls.html">controls</a>.</p>
</div>
<div class="section" id="id26">
<h3>Пример<a class="headerlink" href="#id26" title="Lien permanent vers ce titre">¶</a></h3>
<p>Поставлена задача озвучить удар бросаемого камня так, чтобы
при ударе о различные среды (например, земля и стена) выводился характерный звук.
На сцене в Blender&#8217;е имеются ограничивающие меши с физическими материалами, их идентификаторы &#8220;TERRAIN&#8221; и &#8220;WALL&#8221;.
На сцене также присутствует бросаемый физический объект с названием &#8220;Stone&#8221;.</p>
<p>Определим по одному сенсору соударения (Collision Sensor) для каждой среды,
по типу издаваемого звука.</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="c1">// import the modules</span>
<span class="kd">var</span> <span class="nx">m_scenes</span> <span class="o">=</span> <span class="nx">b4w</span><span class="p">.</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;scenes&quot;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">m_controls</span> <span class="o">=</span> <span class="nx">b4w</span><span class="p">.</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;controls&quot;</span><span class="p">);</span>

<span class="c1">// get the object being thrown</span>
<span class="kd">var</span> <span class="nx">stone</span> <span class="o">=</span> <span class="nx">m_scenes</span><span class="p">.</span><span class="nx">get_object_by_name</span><span class="p">(</span><span class="s2">&quot;Stone&quot;</span><span class="p">);</span>

<span class="c1">// create the sensors</span>
<span class="kd">var</span> <span class="nx">sensor_impact_terrain</span> <span class="o">=</span> <span class="nx">m_controls</span><span class="p">.</span><span class="nx">create_collision_sensor</span><span class="p">(</span><span class="nx">stone</span><span class="p">,</span> <span class="s2">&quot;TERRAIN&quot;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">sensor_impact_wall</span>    <span class="o">=</span> <span class="nx">m_controls</span><span class="p">.</span><span class="nx">create_collision_sensor</span><span class="p">(</span><span class="nx">stone</span><span class="p">,</span> <span class="s2">&quot;WALL&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>Добавим сенсоры в массив. В качестве логической функции используем логическое <code class="docutils literal"><span class="pre">ИЛИ</span></code>. В обработчике напишем код для воспроизведения звука. Создадим множество сенсоров с идентификатором &#8220;IMPACT&#8221; и типом <code class="docutils literal"><span class="pre">CT_SHOT</span></code> (одномоментный).</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="c1">// array of the sensors</span>
<span class="kd">var</span> <span class="nx">impact_sens_array</span> <span class="o">=</span> <span class="p">[</span><span class="nx">sensor_impact_terrain</span><span class="p">,</span> <span class="nx">sensor_impact_wall</span><span class="p">];</span>

<span class="c1">// manifold logic function</span>
<span class="kd">var</span> <span class="nx">impact_sens_logic</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span> <span class="p">{</span><span class="k">return</span> <span class="p">(</span><span class="nx">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">||</span> <span class="nx">s</span><span class="p">[</span><span class="mi">1</span><span class="p">])};</span>

<span class="c1">// callback</span>
<span class="kd">var</span> <span class="nx">impact_cb</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">manifold_id</span><span class="p">,</span> <span class="nx">pulse</span><span class="p">)</span> <span class="p">{</span>

    <span class="c1">// NOTE: it&#39;s possible to play both sounds simultaneously</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">m_controls</span><span class="p">.</span><span class="nx">get_sensor_value</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">manifold_id</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// ...</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;play the terrain impact sound&quot;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">m_controls</span><span class="p">.</span><span class="nx">get_sensor_value</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">manifold_id</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// ...</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;play the wall impact sound&quot;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// create the manifold</span>
<span class="nx">m_controls</span><span class="p">.</span><span class="nx">create_sensor_manifold</span><span class="p">(</span><span class="nx">stone</span><span class="p">,</span> <span class="s2">&quot;IMPACT&quot;</span><span class="p">,</span> <span class="nx">m_ctl</span><span class="p">.</span><span class="nx">CT_SHOT</span><span class="p">,</span>
    <span class="nx">impact_sens_array</span><span class="p">,</span> <span class="nx">impact_sens_logic</span><span class="p">,</span> <span class="nx">impact_cb</span><span class="p">);</span>
</pre></div>
</div>
<p>При столкновении объекта &#8220;Stone&#8221; с любым из физических материалов
&#8220;TERRAIN&#8221; или &#8220;WALL&#8221; происходит вызов функции-обработчика.
Внутри этой функции получим значения обоих сенсоров по их индексу в массиве сенсоров (0 - &#8220;TERRAIN&#8221;, 1 - &#8220;WALL&#8221;).
Значение сенсора = 1 (активный) означает, что произошло столкновение с соответствующим физическим материалом.
В результате воспроизводится соответствующий звук (код не показан).</p>
</div>
</div>
<div class="section" id="repo-file-structure">
<span id="id27"></span><h2>Файловая структура SDK<a class="headerlink" href="#repo-file-structure" title="Lien permanent vers ce titre">¶</a></h2>
<dl class="docutils">
<dt><strong>apps_dev</strong></dt>
<dd><p class="first">исходный код приложений</p>
<dl class="last docutils">
<dt><strong>code_snippets</strong></dt>
<dd><p class="first">исходные файлы приложения для демонстрации примеров использования API Blend4Web</p>
<dl class="last docutils">
<dt><strong>scripts</strong></dt>
<dd>исходные файлы самих примеров использования API Blend4Web</dd>
</dl>
</dd>
<dt><strong>dairy_plant</strong></dt>
<dd>исходные файлы приложения &#8220;Молочный завод&#8221; (доступно только в SDK Pro)</dd>
<dt><strong>fashion</strong></dt>
<dd>исходные файлы приложения &#8220;Показ мод&#8221; (доступно только в SDK Pro)</dd>
<dt><strong>firstperson</strong></dt>
<dd>исходные файлы приложения &#8220;Ферма&#8221; (доступно только в SDK Pro)</dd>
<dt><strong>flight</strong></dt>
<dd>исходные файлы приложения &#8220;Остров&#8221;</dd>
<dt><strong>new_year</strong></dt>
<dd>исходные файлы открытки &#8220;С новым годом 2015&#8221;</dd>
<dt><strong>project.py</strong></dt>
<dd>скрипт для разработчиков приложений</dd>
<dt><strong>victory_day_2015</strong></dt>
<dd>исходные файлы открытки &#8220;День победы 70&#8221;</dd>
<dt><strong>viewer</strong></dt>
<dd><p class="first">исходные файлы приложения для просмотра сцен Viewer</p>
<dl class="last docutils">
<dt><strong>assets.json</strong></dt>
<dd>метаданные с информацией о сценах, загружаемых просмотрщиком сцен
Viewer</dd>
</dl>
</dd>
<dt><strong>webplayer</strong></dt>
<dd>исходные файлы веб-плеера</dd>
<dt><strong>website</strong></dt>
<dd>исходные файлы приложений, размещаемых на официальном сайте Blend4Web</dd>
</dl>
</dd>
<dt><strong>blender</strong></dt>
<dd>исходные файлы сцен в формате Blender</dd>
<dt><strong>blender_scripts</strong></dt>
<dd>экспортер и вспомогательные скрипты для Blender&#8217;а</dd>
<dt><strong>csrc</strong></dt>
<dd>исходный код бинарной части экспортера движка и других утилит на языке C</dd>
<dt><strong>deploy</strong></dt>
<dd><p class="first">директория с ресурсами для размещения на сервере (исходные файлы сцен,
скомпилированные приложения и документация)</p>
<dl class="last docutils">
<dt><strong>api_doc</strong></dt>
<dd>документация API движка для разработчиков
(собирается автоматически, на основе исходного кода движка)</dd>
<dt><strong>apps</strong></dt>
<dd><p class="first">3D-приложения, предназначенные для развертывания, директория
дублирует <em>apps_dev</em></p>
<dl class="last docutils">
<dt><strong>common</strong></dt>
<dd>Файлы скомпилированного движка. Используются приложениями из состава
SDK (отсюда и название).</dd>
</dl>
</dd>
<dt><strong>assets</strong></dt>
<dd>загружаемые ресурсы: сцены, текстуры, звуковые файлы</dd>
<dt><strong>doc</strong></dt>
<dd>настоящее руководство пользователя в формате HTML, собирается
автоматически из <em>doc_src</em></dd>
<dt><strong>globals_detect</strong></dt>
<dd>вспомогательный код для определения глобальных переменных</dd>
<dt><strong>tutorials</strong></dt>
<dd>исходные файлы обучающих примеров</dd>
</dl>
</dd>
<dt><strong>doc_src</strong></dt>
<dd>исходный код настоящего руководства пользователя на языке разметки reST</dd>
<dt><strong>index.html</strong> и <strong>index_assets</strong></dt>
<dd>файлы главной веб-страницы SDK</dd>
<dt><strong>license</strong></dt>
<dd>файлы с текстами лицензионных соглашений</dd>
<dt><strong>Makefile</strong></dt>
<dd>файл сборки для компиляции движка, приложений, документации, развертывания
на удаленном сервере (недоступен в бесплатной версии)</dd>
<dt><strong>README.rst</strong></dt>
<dd>файл README</dd>
<dt><strong>scripts</strong></dt>
<dd><p class="first">скрипты</p>
<dl class="last docutils">
<dt><strong>blend4web.lst</strong>, <strong>blend4web_sdk_free.lst</strong> и <strong>blend4web_sdk_pro.lst</strong> (опционально)</dt>
<dd>списки файлов для сборки дистрибутивов</dd>
<dt><strong>check_resources.py</strong></dt>
<dd>скрипт для проверки и сообщения о неиспользуемых ресурсах (изображения и
звуки, на которые ссылаются экспотируемые файлы)</dd>
<dt><strong>compile_b4w.py</strong></dt>
<dd>скрипт для сборки кода движка и приложений</dd>
<dt><strong>converter.py</strong></dt>
<dd>скрипт, осуществляющий: уменьшение разрешения текстур вдвое, компрессию текстур в формат DDS, конвертацию звуковых файлов в форматы mp4 и ogg</dd>
<dt><strong>custom_json_encoder.py</strong></dt>
<dd>форк Python-модуля json, сортирует ключи по алфавиту в обратном порядке</dd>
<dt><strong>gen_glmatrix.sh</strong></dt>
<dd>скрипт для генерации математического модуля на основе исходных файлов из
репозитория glMatrix 2</dd>
<dt><strong>graph.sh</strong></dt>
<dd>генератор текущего графа сцены в формате svg, используется для отладки
рендеринга</dd>
<dt><strong>make_dist.py</strong></dt>
<dd>сборщик дистрибутивов</dd>
<dt><strong>memory.sh</strong></dt>
<dd>скрипт для проверки обычной (RAM) и видео-памяти (VRAM)</dd>
<dt><strong>mod_list.py</strong></dt>
<dd>скрипт для генерации списка модулей, используемых в приложениях</dd>
<dt><strong>plot.sh</strong></dt>
<dd>построитель графиков отладочной информации</dd>
<dt><strong>process_blend.py</strong></dt>
<dd>скрипт для автоматического переэкспорта всех сцен из состава SDK</dd>
<dt><strong>remove_alpha_channel.sh</strong></dt>
<dd>скрипт для удаления альфа-канала изображения</dd>
<dt><strong>screencast.sh</strong></dt>
<dd>скрипт для записи видео с экрана</dd>
<dt><strong>shader_analyzer.py</strong></dt>
<dd>скрипт, запускающий локальный веб-сервер, который осуществляет подсчет
сложности шейдеров</dd>
<dt><strong>translator.py</strong></dt>
<dd>скрипт для сборки файлов с переводами аддона</dd>
</dl>
</dd>
<dt><strong>shaders</strong></dt>
<dd>GLSL-шейдеры движка</dd>
<dt><strong>src</strong></dt>
<dd><p class="first">основной исходный код ядра движка</p>
<dl class="last docutils">
<dt><strong>addons</strong></dt>
<dd>исходный код дополнений движка</dd>
<dt><strong>ext</strong></dt>
<dd>исходный код внешних объявлений, формирующих API движка</dd>
<dt><strong>libs</strong></dt>
<dd>исходный код библиотек</dd>
</dl>
</dd>
<dt><strong>tools</strong></dt>
<dd><p class="first">Различные инструменты для сборки движка, приложений и конвертации ресурсов</p>
<dl class="last docutils">
<dt><strong>converter_utils</strong></dt>
<dd>сборки утилит для конвертации ресурсов</dd>
<dt><strong>closure-compiler</strong></dt>
<dd>компилятор Google Closure, файлы исключений к нему, генераторы файлов исключений</dd>
<dt><strong>glsl</strong></dt>
<dd><dl class="first last docutils">
<dt><strong>compiler</strong></dt>
<dd>компилятор GLSL-шейдеров движка</dd>
<dt><strong>pegjs</strong></dt>
<dd>грамматики парсер-генератора PEG.js для реализации препроцессора GLSL,
а также скрипт для генерации модулей парсеров из этих грамматик</dd>
</dl>
</dd>
<dt><strong>yuicompressor</strong></dt>
<dd>утилита для сжатия файлов CSS</dd>
</dl>
</dd>
<dt><strong>uranium</strong></dt>
<dd>исходный код и скрипты сборки физического движка Uranium (форк Bullet)</dd>
<dt><strong>VERSION</strong></dt>
<dd>содержит текущую версию движка</dd>
</dl>
</div>
<div class="section" id="browser-for-local-loading">
<span id="id28"></span><h2>Загрузка локальных ресурсов<a class="headerlink" href="#browser-for-local-loading" title="Lien permanent vers ce titre">¶</a></h2>
<p>Рендерер движка является Web-приложением, и его работа происходит при просмотре HTML-файла в браузере. После инициализации происходит загрузка ресурсов (сцен, текстур), которая подчиняется <a class="reference external" href="http://ru.wikipedia.org/wiki/Правило_ограничения_домена">правилу ограничения домена</a>, запрещающему, в частности, загрузку из локальной директории.</p>
<p>Начиная с версии 15.02, в состав Blend4Web SDK входит <a class="reference internal" href="setup.html#local-development-server"><span>сервер разработки</span></a>, решающий проблему загрузки локальных ресурсов.</p>
</div>
<div class="section" id="quality-settings">
<span id="id30"></span><h2>Профили качества изображения<a class="headerlink" href="#quality-settings" title="Lien permanent vers ce titre">¶</a></h2>
<p>Для поддержки различных по функциональности платформ в движке реализовано несколько профилей качества изображения:</p>
<blockquote>
<div><ul class="simple">
<li><em>низкое качество</em> (<code class="docutils literal"><span class="pre">P_LOW</span></code>) - отключен ряд функций (тени, динамическое отражение, постпроцессинг), размер текстур для сборочной версии уменьшен вдвое, антиалиасинг отключен</li>
<li><em>высокое качество</em> (<code class="docutils literal"><span class="pre">P_HIGH</span></code>) - используются все запрошенные сценой функции, метод антиалиасинга FXAA</li>
<li><em>максимальное качество</em> (<code class="docutils literal"><span class="pre">P_ULTRA</span></code>) - вдвое увеличено разрешение рендеринга, увеличено разрешение карт теней, метод антиалиасинга SMAA</li>
</ul>
</div></blockquote>
<a class="reference internal image-reference" href="_images/quality.jpg"><img alt="_images/quality.jpg" class="align-center" src="_images/quality.jpg" style="width: 100%;" /></a>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Переключение профилей качества осуществляется программно, до инициализации контекста WebGL. Профиль по умолчанию <code class="docutils literal"><span class="pre">P_HIGH</span></code>.</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">m_cfg</span> <span class="o">=</span> <span class="nx">b4w</span><span class="p">.</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;config&quot;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">m_main</span> <span class="o">=</span> <span class="nx">b4w</span><span class="p">.</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;main&quot;</span><span class="p">);</span>

<span class="nx">m_cfg</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s2">&quot;quality&quot;</span><span class="p">,</span> <span class="nx">m_cfg</span><span class="p">.</span><span class="nx">P_LOW</span><span class="p">);</span>
<span class="nx">m_main</span><span class="p">.</span><span class="nx">init</span><span class="p">(...);</span>
</pre></div>
</div>
<p>Разработчики приложений могут также установить параметр <strong>quality</strong> при инициализации движка с использованием дополнения <code class="docutils literal"><span class="pre">app.js</span></code>:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">m_cfg</span> <span class="o">=</span> <span class="nx">b4w</span><span class="p">.</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;config&quot;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">m_app</span> <span class="o">=</span> <span class="nx">b4w</span><span class="p">.</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;app&quot;</span><span class="p">);</span>

<span class="nx">m_app</span><span class="p">.</span><span class="nx">init</span><span class="p">({</span>
    <span class="nx">canvas_container_id</span><span class="o">:</span> <span class="s2">&quot;body_id&quot;</span><span class="p">,</span>
    <span class="nx">quality</span><span class="o">:</span> <span class="nx">m_cfg</span><span class="p">.</span><span class="nx">P_HIGH</span>
<span class="p">});</span>
</pre></div>
</div>
</div>
<div class="section" id="canvas-nonfullscreen-coords">
<span id="id31"></span><h2>Специфика неполноэкранных приложений<a class="headerlink" href="#canvas-nonfullscreen-coords" title="Lien permanent vers ce titre">¶</a></h2>
<p>Элемент Canvas, на котором осуществляется рендеринг, может изменять своё местоположение относительно окна браузера. Это может происходить в результате манипуляций, проводимых над DOM-деревом, либо в результате скроллинга страницы, что особенно актуально для неполноэкранных приложений.</p>
<p>В большинстве случаев это не будет никак сказываться на работе приложения. Однако для событий, связанных с положением курсора мыши или позицией касания на touch-устройстве, возможно получение некорректных результатов. Это происходит, потому что координаты, получаемые из соответствующих событий, принадлежат системе отсчета относительно окна браузера, а движок работает с координатами в системе отсчета именно Canvas элемента (верхний левый угол элемента).</p>
<ol class="arabic simple">
<li>Если верхний левый угол Canvas&#8217;а совпадает с верхним левым углом окна браузера, и его местоположение не будет изменяться, то достаточно использовать координаты event.clientX и event.clientY соответствующего события либо функции API <a class="reference external" href="https://www.blend4web.com/api_doc/module-mouse.html#.get_coords_x">get_coords_x()</a> и <a class="reference external" href="https://www.blend4web.com/api_doc/module-mouse.html#.get_coords_y">get_coords_y()</a>:</li>
</ol>
<div class="highlight-javascript"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">m_mouse</span>   <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;mouse&quot;</span><span class="p">);</span>

<span class="c1">// . . .</span>
<span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">clientX</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">y</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">clientY</span><span class="p">;</span>
<span class="c1">// . . .</span>
<span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="nx">m_mouse</span><span class="p">.</span><span class="nx">get_coords_x</span><span class="p">(</span><span class="nx">event</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">y</span> <span class="o">=</span> <span class="nx">m_mouse</span><span class="p">.</span><span class="nx">get_coords_y</span><span class="p">(</span><span class="nx">event</span><span class="p">);</span>
<span class="c1">// . . .</span>
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li>Если на странице присутствует только скроллинг окна браузера, то достаточно использовать координаты event.pageX и event.pageY:</li>
</ol>
<div class="highlight-javascript"><div class="highlight"><pre><span class="c1">// . . .</span>
<span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">pageX</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">y</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">pageY</span><span class="p">;</span>
<span class="c1">// . . .</span>
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li>В случае более сложных манипуляций с положением элемента Canvas (скроллинг отдельных элементов страницы, смещение относительно левого верхнего угла окна браузера, манипуляции с DOM-деревом) требуется корректный пересчет координат. Чтобы получить координаты, подходящие для использования в движке, можно провести преобразование при помощи метода <a class="reference external" href="https://www.blend4web.com/api_doc/module-container.html#.client_to_canvas_coords">client_to_canvas_coords()</a>:</li>
</ol>
<div class="highlight-javascript"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">m_cont</span>   <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;container&quot;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">_vec2_tmp</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Float32Array</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
<span class="c1">// . . .</span>
<span class="kd">var</span> <span class="nx">canvas_xy</span> <span class="o">=</span> <span class="nx">m_cont</span><span class="p">.</span><span class="nx">client_to_canvas_coords</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">clientX</span><span class="p">,</span> <span class="nx">event</span><span class="p">.</span><span class="nx">clientY</span><span class="p">,</span> <span class="nx">_vec2_tmp</span><span class="p">);</span>
<span class="c1">// . . .</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<blockquote>
<div>Для получения координат в системе отсчета Canvas элемента, движок должен знать его положение относительно окна браузера. Однако, если оно будет меняться во время работы приложения (тот же скроллинг), то необходимо будет как-то пересчитывать позицию Canvas&#8217;а. Для того, чтобы это происходило автоматически, нужно выставить настройку <code class="docutils literal"><span class="pre">track_container_position</span></code> при инициализации приложения:</div></blockquote>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">exports</span><span class="p">.</span><span class="nx">init</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">m_app</span><span class="p">.</span><span class="nx">init</span><span class="p">({</span>
        <span class="c1">// . . .</span>
        <span class="nx">track_container_position</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="c1">// . . .</span>
    <span class="p">});</span>
    <span class="c1">// . . .</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<blockquote>
<div>При её использовании в некоторых браузерах (например, Firefox) возможно незначительное снижение производительности вследствие частого обращения к DOM-дереву.
Если этот момент критичен, то вместо флага <code class="docutils literal"><span class="pre">track_container_position</span></code> можно пользоваться методами <a class="reference external" href="https://www.blend4web.com/api_doc/module-container.html#.force_offsets_updating">force_offsets_updating()</a>, <a class="reference external" href="https://www.blend4web.com/api_doc/module-container.html#.update_canvas_offsets">update_canvas_offsets()</a> или более низкоуровневым <a class="reference external" href="https://www.blend4web.com/api_doc/module-container.html#.set_canvas_offsets">set_canvas_offsets()</a> для обновления положения элемента Canvas вручную, когда это действительно необходимо:</div></blockquote>
<div class="highlight-javascript"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">m_cont</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;container&quot;</span><span class="p">);</span>
<span class="c1">// . . .</span>
<span class="nx">m_cont</span><span class="p">.</span><span class="nx">force_offsets_updating</span><span class="p">();</span>
<span class="c1">// . . .</span>
<span class="nx">m_cont</span><span class="p">.</span><span class="nx">update_canvas_offsets</span><span class="p">();</span>
<span class="c1">// . . .</span>
<span class="nx">m_cont</span><span class="p">.</span><span class="nx">set_canvas_offsets</span><span class="p">(</span><span class="nx">offset_left</span><span class="p">,</span> <span class="nx">offset_top</span><span class="p">);</span>
<span class="c1">// . . .</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<ol class="arabic simple" start="4">
<li>Возможность масштабирования всей веб-страницы на мобильных устройствах также может приводить к смещению элемента Canvas. Описанные выше решения годятся и для этого случая, однако, в качестве альтернативы можно запретить масштабирование вовсе и избежать подобных проблем. Для этого достаточно в заголовке страницы добавить следующий мета-тег:</li>
</ol>
<div class="highlight-html"><div class="highlight"><pre><span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">&quot;viewport&quot;</span> <span class="na">content=</span><span class="s">&quot;user-scalable=no&quot;</span><span class="nt">&gt;</span>
</pre></div>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="developers_advanced.html" class="btn btn-neutral float-right" title="Разработчикам движка" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="logic_editor.html" class="btn btn-neutral" title="Визуальное программирование" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Triumph LLC.
      Mis à jour le 2015-12-22.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'v15.12',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="_static/translations.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>