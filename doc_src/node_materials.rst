.. index:: материалы; ноды

.. _node_materials:

*****************
Нодовые материалы
*****************

.. contents:: Содержание
    :depth: 3
    :backlinks: entry


Шейдерные ноды (Shader Nodes) существенно расширяют возможности стандартных материалов Blender, позволяя представить освещение как серию базовых преобразований.

.. image:: src_images/node_materials/node_materials_title.png
   :align: center
   :width: 100%


.. _generic_node_materials:

Стандартные ноды
================

.. index:: материалы; ноды

Полностью поддерживаются все возможности Blender, за исключением следующих случаев:

* ``Geometry`` - не поддерживается выход ``Vertex Alpha``.
* ``Lamp data`` - не поддерживается выход ``Shadow``.
* ``Material``, ``Extended Material`` - допускается не больше одной ноды на материал,
  не поддерживаются входы ``Refl``, ``Ambient``, ``SpecTra`` и выход ``AO``.
* ``RGB Curves``, ``Vector Curves``, ``ColorRamp`` и Cycles-ноды поддерживаются ограниченно.

Кроме того, в контексте рендеринга в реальном времени, следует учитывать низкую производительность некоторых нод. Не рекомендуется к использованию:

* ``Hue/Saturation``
* ``MixRGB`` типы ``Burn``, ``Dodge``, ``Value``, ``Saturation``, ``Hue``, ``Color``

Не рекомендуется создавать сложные материалы, особенно использующие большое
количество нод ``Geometry`` и ``Texture``.


.. _custom_node_materials:

Дополнительные ноды
===================

.. index:: материалы; ноды

Дополнительные ноды расширяют функционал стандартных с учётом специфики работы движка. Ноды оформляются в виде нодовых групп (``Node Groups`` или ``Node Tree``) со специально выбранным именем и форматом входов. Для удобства, все дополнительные ноды добавляются в blend-файл при его открытии.

.. image:: src_images/node_materials/node_materials_nodes.png
   :align: center


.. _node_gamma:

Linear to SRGB и SRGB to Linear (Deprecated)
--------------------------------------------

Преобразование цвета из линейного цветового пространства в пространство sRGB и наоборот. Функционал объявлен устаревшим с версии 15.04. В более новых версиях для преобразования цвета из sRGB в линейное пространство следует использовать нативную ноду ``Gamma`` со значением 2.200, а для преобразования из линейного пространства в sRGB - ту же ноду со значением 0.455.

.. image:: src_images/node_materials/node_materials_gamma.png
   :align: center


.. seealso:: :ref:`gamma_node_materials`

.. _node_replace:

Replace (B4W_REPLACE)
---------------------

Осуществляет замену входов в зависимости от того, в какой среде (viewport Blender'а или движок) в данный момент работает текущая сцена. При работе в Blender вход ``Color1`` подключается к выходу ``Color``, вход ``Color2`` игнорируется. При работе в движке входы меняются местами (``Color1`` игнорируется, ``Color2`` подключается к выходу). Нода предназначена для отображения во viewport'e одной конструкции нодов, а в движке - другой.

.. image:: src_images/node_materials/node_materials_replace.png
   :align: center
   :width: 100%

Используется, как правило, для подключения карт нормалей. Нодовые материалы Blender'а не поддерживают тангентное пространство координат, в связи с чем единственный способ корректного отображения карт нормалей во viewport'e - их подключение внутри нод ``Material``.

Входные параметры
.................

*Color1*
    Конструкция нод, видимая во вьюпорте Blender'а

*Color2*
    Конструкция нод, видимая объекта в движке Blend4Web.

Выходные параметры
..................

*Color*
    Следует подключать к выходу ``Color`` ноды ``Material`` или ``Extended Material``.

.. _node_clamp:

Clamp (B4W_CLAMP)
-----------------

Осуществить операцию ограничения над входом. В результате, все элементы вектора на выходе
получают значения от 0 до 1 включительно.

.. image:: src_images/node_materials/node_materials_clamp.png
   :align: center
   :width: 100%

Входные параметры
.................

*Image*
    Заданный вектор.

Выходные параметры
..................

*Image*
    Вектор после ограничения.


.. _node_time:

Time (B4W_TIME)
---------------

Осуществляет отсчет времени с момента старта движка в секундах. Может использоваться для анимации любых параметров в нодовых материалах - UV-координат, факторов смешивания, прозрачности и т.п.

.. image:: src_images/node_materials/node_time.png
   :align: center

Входные параметры
.................

Отсутствуют.

Выходные параметры
..................

*Value*
    Время (в секундах), прошедшее с момента старта движка.

.. seealso:: :ref:`node_anim`

.. _node_vector_view:

Vector View (B4W_VECTOR_VIEW)
-----------------------------

Осуществить преобразование вектора в пространство камеры. Преобразование необходимо, поскольку при работе в движке большинство векторов определены в мировой системе координат (например нормали, направления источников освещения и т.д). Преобразованный таким образом вектор нормали используется только для различных эффектов и не должен подключаться к входу ноды ``Material`` или ``Extended Material``.

.. image:: src_images/node_materials/node_materials_vector_view.png
   :align: center
   :width: 100%

Входные параметры
.................

*Vector*
    Вектор в мировой системе координат.

Выходные параметры
..................

*Vector*
    Вектор в системе координат камеры.

.. _node_parallax:

Parallax (B4W_PARALLAX)
-----------------------

Реализует смещение текстурных координат в соответствии с картой высот.

.. image:: src_images/node_materials/node_materials_parallax.png
   :align: center
   :width: 100%

Входные параметры
.................

*UV*
   Исходные текстурные координаты.

*Height Map*
   RGBA текстура с картой высот в альфа канале.

*Scale*
   Коэффициент смещения текстурных координат.

*Steps*
   Количество шагов при генерации смещенных текстурных координат. Чем больше данное значение, тем выше качество получаемой текстуры.

*Lod Distance*
   Максимальное расстояние от камеры, на котором виден эффект.

Выходные параметры
..................

*UV*
   Измененные текстурные координаты, которые используются как вход для текстурных нод.

.. _node_translucency:

Translucency (B4W_TRANSLUCENCY)
-------------------------------

Реализует эффект полупрозрачности (только по отношению к источникам света) для тонких объектов, таких как ткань, листва, бумага и др. Эффект состоит из двух частей: засвечивание обратной по отношению к источнику стороны объекта и появление светового пятна непосредственно в том месте, где должен был находится источник.

.. image:: src_images/node_materials/node_materials_translucency.png
   :align: center
   :width: 100%

Входные параметры
.................

*Color*
    Одноканальная текстура, определяющая неоднородность материала, белый - максимальный эффект просвечивания, черный - его отсутствие. По умолчанию используется белый.
*Backside Factor*
    Коэффицент коррекции цвета материала на обратной от источника света стороне. Основан на визуальном эффекте большей насыщенности цвета при просвечивании.

    * *Backside Factor < 1* - коррекция в сторону осветления
    * *Backside Factor = 1* - без коррекции
    * *Backside Factor > 1* - коррекция в сторону затемнения

    Значение по умолчанию: 1.
*Spot Hardness*
    Коэффициент размытия светового пятна. При увеличении размеры пятна уменьшаются, края становятся более резкими.
    Значение по умолчанию: 1000.
*Spot Intensity*
    Интенсивность светового пятна. При увеличении становится более ярким.
    Значение по умолчанию: 1.
*Spot Diffuse Factor*
    Коэффициент влияния диффузного цвета материала на цвет светового пятна.

    * *Spot Diffuse Factor = 0* - световое пятно имеет диффузный цвет
    * *Spot Diffuse Factor = 1* - световое пятно имеет белый цвет

    Значение по умолчанию: 1.

Выходные параметры
..................

*Translucency*
	Выход должен быть подключен ко входу ``Translucency`` ноды ``Extended Material``.

.. note::

  Возможно некорректное поведение ноды, если используются :ref:`отредактированные нормали <normals_editor>`.

.. _node_refraction:

Refraction (B4W_REFRACTION)
---------------------------

Реализует эффект преломления. Этот эффект виден только в движке Blend4Web, но не в Blender.

.. image:: src_images/node_materials/node_materials_refraction.png
   :align: center
   :width: 100%

Входные параметры
.................

*Normal*
    Карта нормалей, по которой происходит возмущение (сдвиг).
*Refraction bump*
    Коэффицент возмущения (сдвига) текстуры сцены позади объекта.

    Значение по умолчанию: 0.001.

Выходные параметры
..................

*Color*
    Текстура сцены позади объекта с внесённым возмущением.

.. note::

    Для отображения эффекта необходимо переключить опцию ``Refractions`` на панели ``Render > Reflections and Refractions`` в состояние ``AUTO`` или ``ON``. Объект должен быть с типом прозрачности Alpha Blend.
.. seealso:: :ref:`alpha_blend`

.. _node_quality:

Levels of Quality (B4W_LEVELS_OF_QUALITY)
-----------------------------------------

Устанавливает значение выходного цвета в зависимости от установленного профиля качества изображения. Может применяться, например, для автоматической замены сложного материала более простым при запуске приложения на мобильном устройстве.

.. image:: src_images/node_materials/node_materials_levels_of_quality.png
   :align: center
   :width: 100%

.. seealso:: :ref:`quality_settings`

Входные параметры
.................

*HIGH*
    Значение, которое будет подано в выходной параметр ``Color`` при высоком и максимальном качестве изображения.

*LOW*
    Значение, которое будет подано в выходной параметр ``Color`` при низком качестве изображения.

*Fac*
    Значение, определяющее, какое из значений (``HIGH`` или ``LOW``) будет отображаться в Blender. Может принимать значения от 0 до 1. При значении параметра менее 0.5 будет виден вариант ``HIGH``, при значении 0.5 и выше будет виден вариант ``LOW``.

Выходные параметры
..................

*Color*
    Значение выходного цвета.


.. _node_smoothstep:

Smoothstep (B4W_SMOOTHSTEP)
---------------------------

Осуществить мягкую интерполяцию двух значений, исходя из первого значения.

.. image:: src_images/node_materials/node_materials_smoothstep.png
   :align: center
   :width: 100%

Входные параметры
.................

*Value*
    Значение, на основе которого осуществляется интерполяция.
*Edge0*
    Первое значениe для интерполяции.
*Edge1*
    Второе значениe для интерполяции.

Выходные параметры
..................

*Value*
    Сглаженное значение.

.. note::
    Для корректной интерполяции входное значение ``Value`` должно лежать в диапазоне между ``Edge0`` и ``Edge1``.


.. _glow_output:

Glow Output (B4W_GLOW_OUTPUT)
-----------------------------

Применяет :ref:`эффект свечения (Glow) <glow>` к нодовому материалу. Помимо ноды *B4W_GLOW_OUTPUT* в нодовом материале должна присутствовать нода *Output*.

.. image:: src_images/node_materials/node_materials_glow_output.png
   :align: center
   :width: 100%

Входные параметры
.................

*Glow Color*
    Цвет свечения.
*Factor*
    Степень свечения. *Factor* :math:`\in [0, 1]`.

    * *Factor = 0* - свечение отсутствует.
    * *Factor* :math:`\in (0, 1]` - свечение цветом *Glow Color*.

.. _node_reflect:

Reflect (B4W_REFLECT)
---------------------

Вычисляет отражение заданного вектора относительно заданной нормали. Может применяться для наложения кубической карты (cubemap) на объект.

.. image:: src_images/node_materials/node_materials_reflect.png
   :align: center
   :width: 100%

Входные параметры
.................

*Vector*
    Заданный вектор. Должен быть подключён ко входу ``View`` ноды ``Geometry``.
*Vector*
    Заданная нормаль. Для получения желаемого результата, вектор должен быть нормирован. Должен быть подключён ко входу ``Normal`` ноды ``Geometry``.

Выходные параметры
..................

*Vector*
    Отражённый вектор. Следует подключать к входному параметру ``Vector`` ноды ``Texture``, содержащего кубическую карту.
